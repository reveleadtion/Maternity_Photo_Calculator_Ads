<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maternity Photo Timing Calculator | Two Wild Souls Photography</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: #ffffff; color: #000000; line-height: 1.6; }
        .container { max-width: 1000px; margin: 40px auto 80px; padding: 0 20px; }
        .card { background: white; border: 1px solid #000000; padding: 60px; margin-top: 30px; }
        .form-group { margin-bottom: 35px; }
        .form-group label { display: block; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 14px; margin-bottom: 12px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; color: #000000; }
        .form-group input, .form-group select { width: 100%; padding: 16px; border: 1px solid #000000; font-size: 16px; font-family: 'Helvetica Neue', Arial, sans-serif; transition: all 0.3s; background: white; }
        .form-group input:focus { outline: none; border: 2px solid #000000; padding: 15px; }
        .form-group small { display: block; margin-top: 8px; color: #666666; font-size: 13px; font-weight: 300; }
        .radio-group { display: flex; gap: 20px; flex-wrap: wrap; }
        .radio-option { flex: 1; min-width: 220px; }
        .radio-option.radio-option--third { min-width: 140px; }
        .radio-option input { display: none; }
        .radio-label { display: block; padding: 16px 24px; border: 1px solid #000000; cursor: pointer; text-align: center; transition: all 0.2s ease; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; background: white; color: #000000; }
        .radio-option input:checked + .radio-label { background: #000000; color: #ffffff; }
        .radio-label:hover { background: #f5f5f5; }
        .radio-option input:checked + .radio-label:hover { background: #000000; }
        .btn { width: 100%; padding: 18px; background: #000000; color: #ffffff; border: none; font-size: 14px; font-weight: 500; font-family: 'Helvetica Neue', Arial, sans-serif; cursor: pointer; margin-top: 20px; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1.5px; }
        .btn:hover { background: #333333; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .location-status { margin-top: 12px; padding: 12px 16px; font-size: 13px; display: none; animation: fadeIn 0.3s ease; border: 1px solid #000000; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .location-status.checking { display: block; background: #f5f5f5; color: #000000; border-color: #cccccc; }
        .location-status.checking::before { content: '‚è≥'; display: inline-block; margin-right: 8px; animation: pulse 1.5s ease-in-out infinite; }
        .location-status.found { display: block; background: #000000; color: #ffffff; border-color: #000000; }
        .location-status.error { display: block; background: #f5f5f5; color: #000000; border-color: #999999; }
        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #ffffff; animation: spin 1s linear infinite; margin-left: 10px; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .results { display: none; }
        .results.active { display: block; }
        .results-hero { background: #eceae6; color: #000000; padding: 35px 35px 30px; margin-bottom: 40px; border: 1px solid rgba(0,0,0,0.1); }
        .results.late .results-hero { border: 2px solid #c94b4b; background: #f5f5f5; }
        .hero-header { text-align: center; padding-bottom: 25px; margin-bottom: 25px; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .hero-header h3 { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 15px; font-weight: 500; margin-bottom: 18px; text-transform: uppercase; letter-spacing: 2px; color: #000000; }
        .current-week-badge { font-size: 16px; font-weight: 500; margin: 12px 0 8px; padding: 10px 20px; background: rgba(0,0,0,0.08); display: inline-block; border: 1px solid rgba(0,0,0,0.15); color: #000000; text-transform: uppercase; letter-spacing: 1px; }
        .date-range-display { font-size: 22px; font-weight: 700; margin: 15px 0 8px; color: #000000; word-break: break-word; }
        .results.late .date-range-display { color: #c94b4b; font-size: 20px; }
        .weeks-range-display { font-size: 14px; opacity: 0.85; color: #000000; }
        .hero-info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 25px; }
        .hero-info-item { text-align: center; padding: 18px 12px; background: rgba(255,255,255,0.5); border: 1px solid rgba(0,0,0,0.1); }
        .hero-info-item .icon { font-size: 28px; margin-bottom: 8px; display: block; }
        .hero-info-item h4 { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 9px; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 500; color: #666; }
        .hero-info-item .value { font-size: 16px; font-weight: 500; color: #000000; display: block; margin-bottom: 5px; }
        .hero-info-item .description { font-size: 11px; color: #666; line-height: 1.3; }
        .results.late .hero-info-item .value { color: #c94b4b; }
        .explanation { background: #f5f5f5; border-left: 3px solid #000000; padding: 40px; margin: 40px 0; }
        .explanation h4 { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 16px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 500; }
        .explanation ul { margin: 20px 0 20px 25px; font-size: 15px; line-height: 1.8; }
        .explanation li { margin-bottom: 12px; }
        .explanation p { font-size: 15px; line-height: 1.8; margin-bottom: 15px; }
        .cta-btn { display: inline-block; padding: 16px 40px; background: #000000; color: #ffffff; text-decoration: none; font-size: 13px; font-weight: 500; font-family: 'Helvetica Neue', Arial, sans-serif; margin: 15px; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1.5px; border: none; }
        .cta-btn:hover { background: #333333; }
        .referral-btn { padding: 14px 32px; font-size: 12px; letter-spacing: 1px; margin: 0; }
        .referral-btn--outline { background: #ffffff; color: #000000; border: 1px solid #000000; }
        .referral-btn--outline:hover { background: #f5f5f5; }
        .cta-block { padding: 50px 40px; }
        .cta-btn-group { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; align-items: center; }
        .cta-btn-group a { display: block; }
        .footer { text-align: center; padding: 60px 20px; color: #666666; font-size: 13px; border-top: 1px solid #e5e5e5; margin-top: 60px; }
        .footer p { margin-bottom: 8px; }
        .footer a { color: #000000; text-decoration: none; font-weight: 500; border-bottom: 1px solid #000000; }
        .footer a:hover { border-bottom: 2px solid #000000; }

        @media (max-width: 768px) {
            .container { margin: 0; padding: 0; max-width: 100%; }
            .card { padding: 0; border: none; margin-top: 0; }
            #form-card { padding: 28px 16px 32px; border: none; }
            #form-card h2 { font-size: 18px !important; letter-spacing: 1.5px !important; margin-bottom: 32px !important; }
            .results-hero { padding: 24px 16px 20px; margin-bottom: 0; border-left: none; border-right: none; border-radius: 0; }
            .hero-header { padding-bottom: 18px; margin-bottom: 18px; }
            .hero-header h3 { font-size: 11px; letter-spacing: 1.5px; margin-bottom: 12px; }
            .current-week-badge { font-size: 13px; padding: 7px 14px; }
            .date-range-display { font-size: 17px; }
            .weeks-range-display { font-size: 12px; }
            .radio-group { flex-direction: column; gap: 10px; }
            .radio-option { min-width: 100%; }
            .radio-label { padding: 14px 16px; font-size: 13px; }
            .hero-info-grid { grid-template-columns: 1fr; gap: 8px; margin-top: 18px; }
            .hero-info-item { padding: 14px 16px; display: flex; align-items: center; gap: 14px; text-align: left; }
            .hero-info-item .icon { font-size: 26px; margin-bottom: 0; flex-shrink: 0; }
            .hero-info-item .item-text { flex: 1; min-width: 0; }
            .hero-info-item h4 { font-size: 9px; letter-spacing: 0.8px; margin-bottom: 2px; }
            .hero-info-item .value { font-size: 14px; margin-bottom: 2px; }
            .hero-info-item .description { font-size: 11px; }
            #combined-cta-section { margin-bottom: 0; }
            .cta-block { padding: 32px 20px !important; }
            .cta-block h4 { font-size: 16px !important; letter-spacing: 1px !important; overflow-wrap: break-word; word-break: break-word; }
            .cta-btn-group { flex-direction: column; align-items: center; gap: 10px; }
            .referral-btn { width: 200px; text-align: center; padding: 14px 16px !important; font-size: 12px; display: block; }
            .explanation { padding: 24px 16px; margin: 0; border-left: none; border-top: 3px solid #000; }
            .explanation h4 { font-size: 13px; margin-bottom: 14px; }
            .explanation p, .explanation li { font-size: 14px; }
            #results .card > div:last-child { padding: 24px 16px; margin: 0 !important; }
            .footer { padding: 36px 16px; margin-top: 0; }
        }

        @media (max-width: 480px) {
            #form-card { padding: 24px 14px 28px; }
            #form-card h2 { font-size: 16px !important; }
            .form-group { margin-bottom: 24px; }
            .form-group label { font-size: 12px; letter-spacing: 0.8px; }
            .form-group input { padding: 14px 12px; font-size: 16px; }
            .results-hero { padding: 20px 14px 16px; }
            .hero-header h3 { font-size: 10px; }
            .date-range-display { font-size: 15px; }
            .current-week-badge { font-size: 12px; padding: 6px 12px; }
            .btn { font-size: 13px; letter-spacing: 1px; padding: 16px; }
            .cta-block h4 { font-size: 14px !important; letter-spacing: 0.5px !important; }
            .explanation { padding: 20px 14px; }
            .footer { padding: 32px 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card" id="form-card">
            <h2 style="font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; font-size: 24px; margin-bottom: 50px; font-weight: 300; text-transform: uppercase; letter-spacing: 2px;">Find Your Best Maternity Photo Time</h2>
            <form id="calc-form">
                <div class="form-group">
                    <label for="due-date">What's your due date?</label>
                    <input type="date" id="due-date" required onclick="try{this.showPicker()}catch(e){}">
                </div>
                <div class="form-group">
                    <label>Is this your first baby?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="first-yes" name="first-baby" value="yes" required>
                            <label for="first-yes" class="radio-label">Yes, first baby</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="first-no" name="first-baby" value="no">
                            <label for="first-no" class="radio-label">No, 2nd or later</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="multiples" style="width: auto; margin-right: 12px; transform: scale(1.3);">
                        Expecting multiples (twins, triplets, etc.)
                    </label>
                </div>
                <div class="form-group">
                    <label>Preferred style</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="vibe-full" name="vibe" value="full" required>
                            <label for="vibe-full" class="radio-label">Full, dramatic bump</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="vibe-comfortable" name="vibe" value="comfortable">
                            <label for="vibe-comfortable" class="radio-label">Earlier & more comfortable</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Session setting</label>
                    <div class="radio-group">
                        <div class="radio-option radio-option--third">
                            <input type="radio" id="setting-indoor" name="setting" value="indoor" required>
                            <label for="setting-indoor" class="radio-label">üè† Indoor / Studio</label>
                        </div>
                        <div class="radio-option radio-option--third">
                            <input type="radio" id="setting-outdoor" name="setting" value="outdoor">
                            <label for="setting-outdoor" class="radio-label">üåø Outdoor</label>
                        </div>
                        <div class="radio-option radio-option--third">
                            <input type="radio" id="setting-both" name="setting" value="both">
                            <label for="setting-both" class="radio-label">‚ú® Both</label>
                        </div>
                    </div>
                    <small>Outdoor sessions are best earlier for comfort ‚Äî indoor studio sessions allow more flexibility later in pregnancy</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="high-risk" style="width: auto; margin-right: 12px; transform: scale(1.3);">
                        High-risk pregnancy
                    </label>
                    <small style="margin-top: 8px; display: block;">We recommend scheduling earlier to ensure you're comfortable and have flexibility if plans change</small>
                </div>
                <div class="form-group">
                    <label>Your location</label>
                    <input type="text" id="location-input" placeholder="City, State or Zip Code (e.g., Troy, MI or 48307)" required>
                    <small>Required to determine if you're within 40 miles of our Rochester Hills studio</small>
                    <div class="location-status" id="location-status"></div>
                </div>
                <button type="submit" class="btn" id="submit-btn">Calculate My Perfect Timing ‚ú®</button>
            </form>
        </div>

        <div class="results" id="results">
            <div class="card">
                <div class="results-hero">
                    <div class="hero-header">
                        <h3>Your Ideal Session Window</h3>
                        <div class="current-week-badge" id="current-week-badge">Week ??</div>
                        <div class="date-range-display" id="date-range"></div>
                        <p class="weeks-range-display" id="weeks-range"></p>
                    </div>
                    <div class="hero-info-grid">
                        <div class="hero-info-item">
                            <span class="icon">üìÖ</span>
                            <div class="item-text">
                                <h4>Book By</h4>
                                <span class="value" id="book-by"></span>
                                <p class="description">Most photographers need 4‚Äì8 weeks notice</p>
                            </div>
                        </div>
                        <div class="hero-info-item">
                            <span class="icon">‚è∞</span>
                            <div class="item-text">
                                <h4>Your Status</h4>
                                <span class="value" id="current-week"></span>
                                <p class="description" id="status"></p>
                            </div>
                        </div>
                        <div class="hero-info-item">
                            <span class="icon">‚ú®</span>
                            <div class="item-text">
                                <h4>Backup Option</h4>
                                <span class="value" id="backup"></span>
                                <p class="description">If ideal timing doesn't work</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="combined-cta-section" style="margin-bottom: 40px;"></div>

                <div class="explanation" id="explanation"></div>

                <div style="text-align:center; margin:40px 0;">
                    <button class="btn" onclick="resetCalculator()" style="max-width:400px;">Calculate Again</button>
                </div>
            </div>

            <div class="footer">
                <p>Created with love by <a href="https://twowildsoulsphotography.com" target="_blank">Two Wild Souls Photography</a></p>
                <p style="margin-top: 10px;">Maternity & Newborn portraits in Rochester Hills ‚Ä¢ Metro Detroit</p>
                <p style="margin-top: 20px; font-size: 14px;">¬© 2026 Two Wild Souls Photography ‚Ä¢ All Rights Reserved</p>
            </div>
        </div>
    </div>

    <script>
        function sendHeightToParent() {
            window.parent.postMessage({ calculatorHeight: document.body.scrollHeight }, '*');
        }
        window.addEventListener('load', sendHeightToParent);
        window.addEventListener('resize', sendHeightToParent);
        new MutationObserver(sendHeightToParent).observe(document.body, { childList: true, subtree: true, attributes: true });

        const STUDIO_LAT = 42.6533;
        const STUDIO_LNG = -83.1499;
        const RADIUS_MILES = 40;

        const form = document.getElementById('calc-form');
        const dueDateInput = document.getElementById('due-date');
        const locationInput = document.getElementById('location-input');
        const locationStatus = document.getElementById('location-status');
        const submitBtn = document.getElementById('submit-btn');

        // FIX: Use a proper state object so calculate() always reads current values
        let locationState = {
            checked: false,
            isLocal: false,
            distanceMiles: null,
            checking: false
        };

        let locationDebounceTimer = null;

        // Extended city/state lookup for Metro Detroit area (no fetch needed)
        const localCities = [
            // Oakland County
            'rochester hills','rochester','troy','auburn hills','pontiac','waterford',
            'clarkston','lake orion','oxford','orion township','independence township',
            'birmingham','bloomfield hills','bloomfield township','west bloomfield',
            'novi','wixom','walled lake','milford','highland','white lake',
            'ferndale','royal oak','berkley','hazel park','madison heights',
            'southfield','lathrup village','oak park','huntington woods',
            'sterling heights','utica','shelby township','macomb township',
            'washington township','romeo','ray township',
            // Macomb County
            'clinton township','mount clemens','harrison township','chesterfield',
            'new baltimore','richmond','eastpointe','roseville','st. clair shores',
            'center line','fraser','warren',
            // Wayne County (inner)
            'detroit','dearborn','dearborn heights','livonia','westland','garden city',
            'inkster','wayne','canton','plymouth','northville','farmington hills','farmington',
            'redford','taylor','allen park','lincoln park','wyandotte','riverview',
            'trenton','grosse pointe','grosse pointe park','grosse pointe farms',
            'grosse pointe woods','grosse pointe shores','harper woods',
            // Washtenaw / Livingston fringe
            'ann arbor','ypsilanti','saline','milan','brighton','howell'
        ];

        const today = new Date();
        const minDate = new Date(today); minDate.setMonth(minDate.getMonth() - 2);
        const maxDate = new Date(today); maxDate.setMonth(maxDate.getMonth() + 9);
        dueDateInput.min = minDate.toISOString().split('T')[0];
        dueDateInput.max = maxDate.toISOString().split('T')[0];

        const fallbackFortyMileZips = [
            '48306','48307','48309','48326','48327','48328','48329',
            '48083','48084','48085','48009','48012','48301','48302','48304',
            '48310','48312','48313','48314','48315','48316','48317','48318',
            '48035','48036','48038','48043','48044','48045','48046',
            '48089','48091','48092','48093','48021','48066',
            '48067','48068','48069','48073','48220','48237',
            '48340','48341','48342','48343','48320','48323','48324','48325',
            '48346','48348','48350','48462','48359','48362','48363','48370','48371',
            '48322','48334','48335','48336','48374','48375','48376','48377',
            '48033','48034','48075','48076','48240',
            '48026','48080','48081','48082','48088','48236','48230',
            '48382','48386','48390','48393',
            '48150','48152','48154','48170','48185','48239',
            '48025','48030','48071','48072','48094','48095','48096','48097','48098',
            '48101','48167','48178','48187','48188','48223','48224','48225','48234','48235',
            '48183','48184','48186','48189','48192','48195','48242','48243',
            '48160','48161','48164','48165','48168','48169','48174','48176',
            '48197','48198','48141','48143','48144','48146','48191'
        ];

        locationInput.addEventListener('input', function() {
            clearTimeout(locationDebounceTimer);
            const value = this.value.trim();

            // Reset state when user edits location
            locationState = { checked: false, isLocal: false, distanceMiles: null, checking: false };

            if (value.length < 3) {
                locationStatus.className = 'location-status';
                updateButtonState();
                return;
            }

            // Instant offline check ‚Äî no fetch needed
            locationDebounceTimer = setTimeout(() => checkLocation(value), 400);
        });

        function updateButtonState() {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Calculate My Perfect Timing ‚ú®';
        }

        // Pure offline location check: zip codes + city name matching. No fetch() calls.
        function checkLocation(locationStr) {
            if (!locationStr) return;

            const normalized = locationStr.toLowerCase().trim();

            // 1. Zip code lookup
            const zipMatch = normalized.match(/\b(\d{5})\b/);
            if (zipMatch) {
                if (fallbackFortyMileZips.includes(zipMatch[1])) {
                    locationState = { checked: true, isLocal: true, distanceMiles: 20, checking: false };
                    locationStatus.className = 'location-status found';
                    locationStatus.innerHTML = "‚úì Great! You're in our service area (within 40 miles of Rochester Hills)";
                } else {
                    locationState = { checked: true, isLocal: false, distanceMiles: null, checking: false };
                    locationStatus.className = 'location-status error';
                    locationStatus.innerHTML = "You appear to be outside our 40-mile service area ‚Äî we may still have referrals!";
                }
                return;
            }

            // 2. City name lookup (strip state abbreviation if present, e.g. "Troy, MI")
            const cityOnly = normalized.replace(/,?\s*[a-z]{2}$/, '').trim();
            const matched = localCities.some(city => cityOnly === city || normalized.startsWith(city));

            if (matched) {
                locationState = { checked: true, isLocal: true, distanceMiles: 20, checking: false };
                locationStatus.className = 'location-status found';
                locationStatus.innerHTML = "‚úì Great! You're in our service area (within 40 miles of Rochester Hills)";
            } else if (cityOnly.length >= 3) {
                // Unknown city ‚Äî soft message, don't block
                locationState = { checked: true, isLocal: false, distanceMiles: null, checking: false };
                locationStatus.className = 'location-status error';
                locationStatus.innerHTML = "We couldn't confirm your area ‚Äî you can still submit and we'll follow up!";
            }
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const locationValue = locationInput.value.trim();
            if (!locationValue) {
                locationInput.style.border = '2px solid #c94b4b';
                locationStatus.className = 'location-status error';
                locationStatus.innerHTML = '‚ö†Ô∏è Location is required to provide personalized recommendations';
                locationStatus.style.display = 'block';
                locationInput.focus();
                locationInput.addEventListener('input', function clearError() {
                    locationInput.style.border = '1px solid #000000';
                    locationInput.removeEventListener('input', clearError);
                }, { once: true });
                return;
            }

            // Run check synchronously if not yet done (e.g. user hit Enter quickly)
            if (!locationState.checked) {
                clearTimeout(locationDebounceTimer);
                checkLocation(locationValue);
            }

            calculate();
        });

        function calculate() {
            const dueDateStr = document.getElementById('due-date').value;
            if (!dueDateStr) return alert("Please enter your due date.");

            const dueDate = new Date(dueDateStr);
            const isFirst = document.querySelector('input[name="first-baby"]:checked')?.value === 'yes';
            const multiples = document.getElementById('multiples').checked;
            const vibe = document.querySelector('input[name="vibe"]:checked')?.value || 'full';
            const setting = document.querySelector('input[name="setting"]:checked')?.value || 'both';
            const highRisk = document.getElementById('high-risk').checked;

            const now = new Date();
            const daysSinceLMP = Math.floor((now - new Date(dueDate.getTime() - 280 * 24 * 60 * 60 * 1000)) / (1000 * 60 * 60 * 24));
            const currentWeek = Math.max(1, Math.min(42, Math.ceil(daysSinceLMP / 7)));

            let startWeek, endWeek;
            if (multiples) {
                startWeek = 24; endWeek = 28;
            } else if (!isFirst) {
                startWeek = vibe === 'full' ? 28 : 26;
                endWeek   = vibe === 'full' ? 32 : 30;
            } else {
                startWeek = vibe === 'full' ? 30 : 28;
                endWeek   = vibe === 'full' ? 34 : 32;
            }

            if (!multiples) {
                if (setting === 'outdoor') {
                    startWeek = Math.max(20, startWeek - 2);
                    endWeek   = Math.max(22, endWeek - 2);
                } else if (setting === 'indoor') {
                    startWeek = Math.min(32, startWeek + 1);
                    endWeek   = Math.min(34, endWeek + 1);
                }
            }

            if (highRisk && !multiples) {
                startWeek = Math.max(20, startWeek - 2);
                endWeek   = Math.max(22, endWeek - 2);
            }

            const isLate     = currentWeek > 34;
            const isInWindow = currentWeek >= startWeek && currentWeek <= endWeek;

            const conception = new Date(dueDate);
            conception.setDate(conception.getDate() - 280);

            let startDate, endDate, bookBy;
            if (!isLate) {
                startDate = new Date(conception); startDate.setDate(startDate.getDate() + startWeek * 7);
                endDate   = new Date(conception); endDate.setDate(endDate.getDate() + endWeek * 7);
                bookBy    = new Date(startDate);  bookBy.setDate(bookBy.getDate() - 42);
            }

            const fmt = d => d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });

            document.getElementById('current-week-badge').textContent = `You're at Week ${currentWeek}`;
            document.getElementById('current-week').textContent = `Week ${currentWeek}`;

            if (isLate) {
                document.getElementById('date-range').innerHTML = `Maternity booking window has closed üíï`;
                document.getElementById('weeks-range').textContent = `You're at ${currentWeek} weeks ‚Äî beyond our 34-week cutoff for maternity sessions`;
                document.getElementById('book-by').innerHTML = `<span style="color:#c94b4b;">Passed</span>`;
                document.getElementById('status').textContent = `Beyond our 34-week cutoff`;
                document.getElementById('backup').textContent = `Newborn portraits (first 5‚Äì14 days)`;
            } else {
                document.getElementById('date-range').textContent = `${fmt(startDate)} ‚Äì ${fmt(endDate)}`;
                document.getElementById('weeks-range').textContent = `${startWeek}‚Äì${endWeek} weeks`;
                const bookByPast = bookBy < now;
                document.getElementById('book-by').innerHTML = bookByPast
                    ? `<span style="color:#c94b4b;">Today ‚Äî don't wait!</span>`
                    : fmt(bookBy);
                document.getElementById('status').textContent = isInWindow
                    ? `You're in the sweet spot!`
                    : (currentWeek < startWeek ? `Perfect time to book now` : `Still good ‚Äî don't wait too long`);
                document.getElementById('backup').textContent = `${endWeek}‚Äì${Math.min(endWeek + 4, 36)} weeks (flexible backup)`;
            }

            // Build explanation
            const adjustmentNotes = [];
            if (setting === 'outdoor') adjustmentNotes.push('outdoor sessions (shifted earlier for comfort)');
            if (setting === 'indoor') adjustmentNotes.push('indoor/studio sessions (allows a bit more flexibility later)');
            if (highRisk) adjustmentNotes.push('high-risk pregnancy (shifted earlier to build in flexibility)');
            if (multiples) adjustmentNotes.push('multiple pregnancy (earlier window is standard)');

            let exp = `<h4>Your Personalized Timing</h4>
                       <p>Based on your details, your ideal window is <strong>weeks ${startWeek}‚Äì${endWeek}</strong>.`;
            if (adjustmentNotes.length > 0) {
                exp += ` This has been adjusted for: ${adjustmentNotes.join(', ')}.`;
            }
            exp += `</p>`;

            if (isLate) {
                exp += `<p><strong>Unfortunately our maternity booking window has closed</strong> ‚Äî we are unable to accept maternity sessions beyond 34 weeks. But this chapter isn't over! Here are your best next steps:</p>
                        <ul>
                            <li><strong>Book a newborn session with us</strong> ‚Äî the first 5‚Äì14 days are pure magic and we'd love to capture them</li>
                            <li>If maternity photos are important to you, a few photographers may still accept sessions up to 36‚Äì37 weeks ‚Äî reach out quickly</li>
                            <li>Be open to last-minute dates and comfortable posed styles</li>
                        </ul>
                        <p style="margin-top:25px; font-size:18px; font-weight:600;">‚ú® <strong>Newborn portraits</strong> in those first precious days are absolutely magical ‚Äî and honestly, some of our most breathtaking work. We'd love to be there for it.</p>`;
            } else if (isInWindow) {
                exp += `<p>You're right in the <strong>ideal window</strong> ‚Äî your bump is prominent and you're likely still feeling great. Book now to secure your dream date!</p>`;
            } else if (currentWeek < startWeek) {
                exp += `<p>You're approaching the perfect time ‚Äî now is ideal for reaching out (most photographers need 4‚Äì8 weeks notice).</p>`;
            } else {
                exp += `<p>You're just past the main window but still in a beautiful range. Reach out soon to catch availability.</p>`;
            }
            document.getElementById('explanation').innerHTML = exp;

            // Read from locationState
            const { isLocal, distanceMiles } = locationState;
            const distLabel = isLocal
                ? `‚úì You're ${Math.round(distanceMiles)} miles from our studio`
                : `You're outside our 40-mile service area`;
            const footerNote = `<p style="margin-top: 25px; font-size: 12px; opacity: 0.7;">Professional hair & makeup ‚Ä¢ Designer gowns ‚Ä¢ Serving Rochester Hills & 40-mile radius</p>`;

            const combinedCTAEl = document.getElementById('combined-cta-section');
            let combinedCTA = '';

            if (isLocal) {
                if (isInWindow) {
                    combinedCTA = `
                        <div class="cta-block" style="background:#000;color:#fff;border:2px solid #000;text-align:center;">
                            <div style="font-size:12px;text-transform:uppercase;letter-spacing:2px;margin-bottom:15px;opacity:0.7;">${distLabel}</div>
                            <h4 style="font-family:'Helvetica Neue',Arial,sans-serif;font-size:24px;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px;font-weight:300;">You're in the Perfect Window!</h4>
                            <p style="margin-bottom:30px;font-size:16px;line-height:1.6;">Your bump is beautiful and you're likely still feeling great. This is the ideal time to book your maternity session with Two Wild Souls Photography.</p>
                            <a href="https://twowildsoulsphotography.com/detroit-maternity-photographer-ads" class="cta-btn" target="_blank" style="background:#fff;color:#000;display:inline-block;padding:18px 45px;text-decoration:none;font-size:14px;font-weight:600;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1.5px;margin:0;">Book Your Dream Session</a>
                            <p style="margin-top:25px;font-size:12px;opacity:0.7;">Professional hair & makeup ‚Ä¢ Designer gowns ‚Ä¢ 100% Love It Guarantee</p>
                        </div>`;
                } else if (currentWeek < startWeek) {
                    combinedCTA = `
                        <div class="cta-block" style="background:#000;color:#fff;text-align:center;">
                            <div style="font-size:12px;text-transform:uppercase;letter-spacing:2px;margin-bottom:15px;opacity:0.7;">${distLabel}</div>
                            <h4 style="font-family:'Helvetica Neue',Arial,sans-serif;font-size:22px;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px;font-weight:300;">Secure Your Spot Early</h4>
                            <p style="margin-bottom:30px;font-size:15px;line-height:1.6;opacity:0.9;">Your ideal window is weeks ${startWeek}‚Äì${endWeek}. Many clients book early to lock in their preferred date ‚Äî reach out now and we'll hold your spot.</p>
                            <a href="https://twowildsoulsphotography.com/detroit-maternity-photographer-ads" class="cta-btn" target="_blank" style="background:#fff;color:#000;display:inline-block;padding:18px 45px;text-decoration:none;font-size:14px;font-weight:600;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1.5px;margin:0;">Reserve Your Date</a>
                            ${footerNote}
                        </div>`;
                } else if (isLate) {
                    combinedCTA = `
                        <div class="cta-block" style="background:#c94b4b;color:#fff;border:3px solid #c94b4b;text-align:center;">
                            <div style="font-size:14px;text-transform:uppercase;letter-spacing:2px;margin-bottom:15px;opacity:0.9;">‚ö†Ô∏è Beyond Our Maternity Cutoff ‚Ä¢ ${Math.round(distanceMiles)} miles from studio</div>
                            <h4 style="font-family:'Helvetica Neue',Arial,sans-serif;font-size:24px;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px;font-weight:300;">We Can't Wait to Meet Baby!</h4>
                            <p style="margin-bottom:30px;font-size:16px;line-height:1.6;">At ${currentWeek} weeks, we're unable to book maternity sessions ‚Äî but your newborn session is going to be absolutely magical. Contact us now to reserve your spot for those precious first days.</p>
                            <a href="https://twowildsoulsphotography.com/detroit-maternity-photographer-ads" class="cta-btn" target="_blank" style="background:#fff;color:#c94b4b;display:inline-block;padding:18px 45px;text-decoration:none;font-size:14px;font-weight:600;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1.5px;border:2px solid #fff;margin:0;">Book My Newborn Session</a>
                            <p style="margin-top:25px;font-size:12px;opacity:0.9;">Newborn sessions available in the first 5‚Äì14 days üíï</p>
                        </div>`;
                } else {
                    combinedCTA = `
                        <div class="cta-block" style="background:#000;color:#fff;text-align:center;">
                            <div style="font-size:12px;text-transform:uppercase;letter-spacing:2px;margin-bottom:15px;opacity:0.7;">${distLabel}</div>
                            <h4 style="font-family:'Helvetica Neue',Arial,sans-serif;font-size:22px;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px;font-weight:300;">Still in a Beautiful Range</h4>
                            <p style="margin-bottom:30px;font-size:15px;line-height:1.6;">You're just past the main window but timing is still great. Book soon to secure availability.</p>
                            <a href="https://twowildsoulsphotography.com/detroit-maternity-photographer-ads" class="cta-btn" target="_blank" style="background:#fff;color:#000;display:inline-block;padding:18px 45px;text-decoration:none;font-size:14px;font-weight:600;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1.5px;margin:0;">Book Your Session</a>
                            ${footerNote}
                        </div>`;
                }
            } else {
                combinedCTA = `
                    <div class="cta-block" style="background:#f5f5f5;border:1px solid #000;text-align:center;">
                        <h4 style="font-family:'Helvetica Neue',Arial,sans-serif;font-size:18px;margin-bottom:14px;text-transform:uppercase;letter-spacing:1.5px;font-weight:500;overflow-wrap:break-word;word-break:break-word;">Find a Photographer Near You</h4>
                        <p style="margin-bottom:24px;font-size:14px;color:#666;line-height:1.6;max-width:460px;margin-left:auto;margin-right:auto;">You're outside our 40-mile service area, but we can help you find a qualified maternity photographer in your region.</p>
                        <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
                            <a href="https://www.google.com/search?q=maternity+photographers+near+me" target="_blank" style="width:200px;text-align:center;padding:14px 16px;background:#000;color:#fff;text-decoration:none;font-size:12px;font-weight:500;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1px;box-sizing:border-box;">Find Photographers</a>
                            <a href="https://twowildsoulsphotography.com/detroit-maternity-photographer-ads" style="width:200px;text-align:center;padding:14px 16px;background:#fff;color:#000;border:1px solid #000;text-decoration:none;font-size:12px;font-weight:500;font-family:'Helvetica Neue',Arial,sans-serif;text-transform:uppercase;letter-spacing:1px;box-sizing:border-box;">Get Referrals</a>
                        </div>
                    </div>`;
            }

            combinedCTAEl.innerHTML = combinedCTA;

            document.getElementById('form-card').style.display = 'none';
            const resultsEl = document.getElementById('results');
            resultsEl.classList.add('active');
            if (isLate) resultsEl.classList.add('late');
            setTimeout(() => resultsEl.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
        }

        function resetCalculator() {
            document.getElementById('form-card').style.display = 'block';
            document.getElementById('results').classList.remove('active', 'late');
            form.reset();
            locationStatus.className = 'location-status';
            locationState = { checked: false, isLocal: false, distanceMiles: null, checking: false };
            updateButtonState();
            setTimeout(() => document.getElementById('form-card').scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
        }
    </script>
</body>
</html>
